log = []
report = []

with open("audit.log.txt", mode="r", encoding="utf-8") as f:
    for i in range(2010):
        log.append(f.readline())

def hex_to_string(hex):
    if hex[:2] == '0x':
        hex = hex[2:]
    string_value = bytes.fromhex(hex).decode('utf-8')
    return string_value

report.append("PENTING! TOLONG DI CEK DULU. LINE YANG ADA DI SEBELAH KIRI ITU BERDASARKAN AUDIT.LOG NYA. MOHON PERHATIANNYA UNTUK DILIHAT LAGI\n")

type_log = []

for i in range(len(log)):
    temp = log[i].split(" ")
    if not (temp[0] in type_log):
        type_log.append(temp[0])

type_log = type_log[1::]

report.append("PROCTITLE\n")

for i in range(len(log)):
    if "type=PROCTITLE" in str(log[i]):
        log[i] = log[i].replace("\n", "")
        proctitle = []

        for char in log[i][::-1]:
            if char == '=':
                break
            proctitle.append(char)

        proctitle = "".join(proctitle)[::-1]
        proctitle = proctitle.replace("\n", "")

        if '"' not in proctitle:
            proctitle = hex_to_string(proctitle)

        print(f"line {i+1}: proctitle = {proctitle}")
        report.append(f"line {i+1}: proctitle = {proctitle}")

print("=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================")

report.append(f"\n====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================BATAS_PEMISAH====================================================================================================================================================================================================================================================================================================================================================================================================================================\n")
report.append("EXECUTABLE/COMMAND\n")

for i in range(len(log)):
    if "type=EXECVE" in str(log[i]):
        exe = log[i].split(" ")[3::]

        exe_command = ""

        for j in range(len(exe)):
            temp = exe[j].replace(f"a{j}=", "").replace('"', "").replace("\n", "")
            try:
                temp = hex_to_string(temp)
            except:
                pass
            finally:
                exe_command += f"{temp} "

        print(f"line {i+1}: executable: {exe_command}")
        report.append(f"line {i+1}: executable: {exe_command}")

with open("report.txt", mode="w", encoding="utf-8") as f:
    f.write("\n".join(report))